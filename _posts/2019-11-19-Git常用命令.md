---
layout: post
title: "Git常用命令"
author: "李萌"
categories: learning
tags: [learning]
feature-img: "assets/img/article/git.jpg"
thumbnail: "assets/img/article/git.jpg"
---

#### 一、git基本命令

```
在当前目录下新建一个git仓库
$ git init

克隆一个远端库
$ git clone 仓库地址

把文件添加到仓库
$ git add 文件

提交文件
$ git commit -m "提交的信息"

提交到代码到远程
$ git push origin 分支名称
提交代码到远程主干
$ git push origin master

拉取远程分支到本地
$ git pull origin 分支名称
拉取远程主干分支到本地
$ git pull origin master

查看仓库当前状态
$ git status

查看最近更改内容
$ git diff

显示最近到最远的提交日志
$ git log
$ git log --graph  看到分支合并图
$ git log --pretty=oneline 简化日志输出信息

恢复到上一个提交版本
HEAD当前版本，HEAD^上一个版本，HEAD^^上上个版本，HEAD~100表示往上100个版本
$ git reset --hard HEAD^(提交ID)

查看命令历史以便回到未来
$ git reflog

当你改乱了工作区某个文件的内容，想直接丢弃工作区的修改时，用命令
$ git checkout -- file

当你不但改乱了工作区某个文件的内容，还添加到了暂存区时，
想丢弃修改，分两步，第一步用命令
$ git reset HEAD file
然后再
$ git checkout -- file

关联一个本地仓库到未初始化的远程仓库，例如GitHub仓库上
$ git remote add origin git@github.com:<name>/<name>.git

本地库的内容推送到远程
$ git push -u origin 分支名称
```
#### 二、分支
```
查看当前分支，当前分支前面会标一个*号
$ git branch

创建分支
$ git branch 分支名字

删除分支，-D为强制删除
$ git branch -d 分支名字
$ git branch -D 分支名字

checkout和switch命令都可进行分支切换
$ git switch 分支名字
$ git checkout 分支名字

切换到master主干
$ git switch master
$ git checkout master

创建一个分支并切换到此分支
$ git switch -c 分支名字
$ git checkout -b 分支名字

将本地分支推送到远程服务器
$ git push --set-upstream origin 分支名字

合并分支
$ git merge 分支名字
$ git merge test  表示test合并到master

合并分支，禁用Fast forward
$ git merge --no-ff -m "合并信息" 分支名称

放弃合并分支
$ git merge --abort

删除远程的一个分支
$ git push —-delete origin 分支名字

推送一个空分支到远程，相当于删除远程的一个分支
$ git push origin :refs/heads/分支名字

删除远程不存在的本地分支
$ git fetch -p

删除远程分支报错可能是此分支为工程默认分支
解决办法：
1.进入 github 中该项目的 Settings 页面
2.设置 Default Branch 为其他的分支（例如 master）
3.重新执行删除远程分支命令
```
#### 三、标签
```
创建标签
$ git tag v1.0(名字随便写)

查看所有标签
$ git tag

指定的提交上打标签
$ git tag v0.2 commit_id

查看标签信息
$ git show v0.1

指定标签信息
$ git tag -a 标签名字 -m "标签说明" <commit id>

把本地所有的tag推送到远程
$ git push origin --tags

推送一个本地标签到远程
$ git push origin 标签名字

获取远程tag
$ git fetch origin tag 标签名字

删除标签
$ git tag -d v0.1

如果一个标签已经推送到远程再删除就先删除本地标签再删除远端标签
$ git tag -d v0.1
$ git push origin :refs/tags/标签名字
```
#### 四、远程仓库操作
```
获取远程仓库所有的变动
$ git fetch

查看远程库信息
$ git remote -v

获取所有本地分支和远程分支
$ git branch -a

获取一个远程分支到本地
$ git checkout -b <本地分支名字> origin/<远程分支名字>

本地分支关联到一个远程分支
$ git branch --set-upstream-to=origin/<远程分支> <本地分支>

推送本地的分支到远程origin的分支(没有会自动创建)
$ git push origin <本地分支>:<远程分支>

强制推送本地提交到服务器
$ git push -f origin master

git查看本地分支关联（跟踪）的远程分支之间的对应关系，本地分支对应哪个远程分支
$ git branch -vv
```
#### 五、关于添加git忽略文件
在git中如果想忽略掉某个文件，不让这个文件提交到版本库中，可以在根目录中添加 .gitignore 文件，但是有时候会不生效，原因是.gitignore只能忽略那些原来没有被track的文件，如果某些文件已经被纳入了版本管理中，则修改.gitignore是无效的。那么解决方法就是先把本地缓存删除（改变成未track状态），然后再提交：
```
$ git rm -r --cached .
$ git add .
$ git commit -m 'update .gitignore'
```
GitHub各种配置忽略文件 [.gitignore](https://github.com/github/gitignore)

#### 六、关于Fork的一些命令

有时候Fork完原作者仓库之后，需要跟远程仓库更新同步一下，那么就需要以下几步操作
```
1.首先 把作者的仓库添加到自己的上游远程，通常命名为 upstream，操作一次就可以了
$ git remote add upstream git@github.com:xxx/xxx.git

2.查看远程主机状态，可以看到一个origin是你的，另外一个upstream是原作者的
$ git remote -v

3.拉取原作者的仓库更新
$ git fetch upstream

4.merge或者rebase到自己的的分支上
$ git merge upstream/<对应分支>

5.最后推送到自己的远程仓库就行了
$ git push
```
#### 七、创建SSH Key
有些 Git 服务器都会选择使用 SSH 公钥来进行授权，这样就需要配置SSH Key。

```
1.SSH公钥默认储存在账户的主目录下的 ~/.ssh 目录
$ cd ~/.ssh

2.查看 ~/.ssh 目录所有文件，查看是否有 id_rsa(私钥) 和 id_rsa.pub(公钥)
$ ls

3.无 id_dsa 相关文件，则使用 ssh-keygen 创建
$ ssh-keygen -t rsa -C "youremail@example.com"

4.查看公钥 id_rsa.pub
$ cat ~/.ssh/id_rsa.pub

5.多个ssh, 将公钥保存不同文件中, 如下 github_id_rsa & gitlab_id_rsa
$ ssh-keygen -t rsa -C "youremail@github.com"  -f ~/.ssh/github_id_rsa
$ ssh-keygen -t rsa -C "youremail@gitlab.com"  -f ~/.ssh/gitlab_id_rsa

6.查看不同公钥
$ cat ~/.ssh/github_id_rsa.pub
$ cat ~/.ssh/gitlab_id_rsa.pub

7.在 ~/.ssh 目录配置config文件
# gitlab
Host gitlab.com
HostName gitlab.com
PreferredAuthentications publickey
IdentityFile ~/.ssh/gitlab_id_rsa

# github
Host github.com
HostName github.com
PreferredAuthentications publickey
IdentityFile ~/.ssh/github_id_rsa

8.查看是否连接成功
$ ssh -T youremail@github.com
$ ssh -T youremail@gitlab.com
同时在 ~/.ssh 目录下回生成know_hosts文件来区分不同的ssh, 使用ssh来push和pull
```
#### 八、配置Git别名

举个例子，比如吧git status 配置成 git st
```
$ git config --global alias.st status
```
git log 配置多功能提示效果
```
$ git config --global alias.lg "log --color --graph --pretty=format:'%Cred%h%Creset -%C(yellow)%d%Creset %s %Cgreen(%cr) %C(bold blue)<%an>%Creset' --abbrev-commit"
```



推荐Git教程 ：[廖雪峰Git教程](http://www.liaoxuefeng.com/wiki/0013739516305929606dd18361248578c67b8067c8c017b000)

I"ê<h3 id="1ä¸€ä¸ªnsobjectå ç”¨å¤šå°‘å†…å­˜">1ã€ä¸€ä¸ªNSObjectå ç”¨å¤šå°‘å†…å­˜ï¼Ÿ</h3>

<p>å—é™äºå†…å­˜åˆ†é…çš„æœºåˆ¶ï¼Œä¸€ä¸ª <code class="highlighter-rouge">NSObject</code>å¯¹è±¡éƒ½ä¼šåˆ†é… <code class="highlighter-rouge">16byte</code> çš„å†…å­˜ç©ºé—´ã€‚ä½†æ˜¯å®é™…ä¸Šåœ¨ 32ä½ç³»ç»Ÿä¸Šï¼Œåªä½¿ç”¨äº† <code class="highlighter-rouge">8byte</code>;</p>

<p>ä¸€ä¸ª NSObject å®ä¾‹å¯¹è±¡æˆå‘˜å˜é‡æ‰€å çš„å¤§å°ï¼Œå®é™…ä¸Šæ˜¯ 8 å­—èŠ‚ã€‚</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>size_t obj_size = class_getInstanceSize([NSObject class]);
NSLog(@"class_getInstanceSize ---- %zu", obj_size);
æ‰“å°æ—¥å¿—ï¼šclass_getInstanceSize ---- 8
</code></pre></div></div>

<p>æˆ‘ä»¬å¯ä»¥å»<code class="highlighter-rouge">runtime</code>çš„æºç é‡Œé¢ï¼Œçœ‹ä¸€ä¸‹<code class="highlighter-rouge">class_getInstanceSize</code>å…·ä½“æ˜¯æ€ä¹ˆå®ç°çš„ã€‚OCæ‰€æœ‰å¼€æ”¾çš„æºç åœ°å€<a href="https://link.jianshu.com/?t=https%3A%2F%2Fopensource.apple.com%2Ftarballs%2F">https://opensource.apple.com/tarballs</a></p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>size_t class_getInstanceSize(Class cls)
{
    if (!cls) return 0;
    return cls-&gt;alignedInstanceSize();
}

// Class's ivar size rounded up to a pointer-size boundary.
uint32_t alignedInstanceSize() {
	return word_align(unalignedInstanceSize());
}
</code></pre></div></div>

<p>ä½†è·å– Obj-C æŒ‡é’ˆæ‰€æŒ‡å‘çš„å†…å­˜çš„å¤§å°ï¼Œå®é™…ä¸Šæ˜¯16 å­—èŠ‚</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>NSObject *obj = [NSObject new];
size_t m_size = malloc_size((__bridge const void *)obj);
NSLog(@"malloc_size ---- %zu", m_size);
æ‰“å°ï¼šmalloc_size ---- 16
</code></pre></div></div>

:ET
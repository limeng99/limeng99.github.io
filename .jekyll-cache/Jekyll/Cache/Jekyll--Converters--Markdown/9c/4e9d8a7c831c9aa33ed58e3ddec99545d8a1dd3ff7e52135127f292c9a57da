I"v<p>iOSçš„åº”ç”¨ä¸­ï¼Œç”¨æˆ·ä¸APPè¿›è¡Œäº¤äº’ï¼Œä¼šäº§ç”Ÿå¾ˆå¤šäº‹ä»¶ï¼Œè¿™äº›äº‹ä»¶æ˜¯å¦‚ä½•ä¼ é€’ï¼Œå“åº”çš„é“¾æ¡æœ‰äº‹æ€ä¹ˆæ ·çš„ï¼Œä¸‹é¢ä¼šä¸€ä¸€è§£ç­”ä»¥ä¸Šçš„é—®é¢˜ã€‚</p>

<h3 id="ä¸€-äº‹ä»¶ä¼ é€’å“åº”æµç¨‹">ä¸€. äº‹ä»¶ä¼ é€’&amp;å“åº”æµç¨‹</h3>

<p>äº‹ä»¶ä¼ é€’&amp;å“åº”è¯¦æƒ…å›¾ï¼š</p>

<p><img src="https://raw.githubusercontent.com/limeng99/limeng99.github.io/master/assets/img/screenshots/event-process.png" alt="event-process" /></p>

<ul>
  <li>
    <p>IOKit.framework ä¸ºç³»ç»Ÿå†…æ ¸çš„åº“</p>
  </li>
  <li>
    <p>SpringBoard.app ç›¸å½“äºæ‰‹æœºçš„æ¡Œé¢</p>
  </li>
  <li>
    <p>Source1 ä¸»è¦æ¥æ”¶ç³»ç»Ÿçš„æ¶ˆæ¯</p>
  </li>
  <li>
    <p>Source0 - UIApplication - UIWindow</p>
  </li>
  <li>
    <p>ä»windowå¼€å§‹ç³»ç»Ÿä¼šè°ƒç”¨<code class="highlighter-rouge">hitTest:withEvent:</code>å’Œ<code class="highlighter-rouge">pointInside</code>æ¥æ‰¾åˆ°æœ€ä¼˜å“åº”è€…ï¼Œå…·ä½“è¿‡ç¨‹å¯å‚è€ƒä¸‹å›¾ï¼š</p>
  </li>
</ul>

<p><img src="https://raw.githubusercontent.com/limeng99/limeng99.github.io/master/assets/img/screenshots/event-schematic.png" alt="event-process1" /></p>

<ul>
  <li>
    <p>æ¯”å¦‚æˆ‘ä»¬åœ¨self.view ä¸Šä¾æ¬¡æ·»åŠ view1ã€view2ã€view3ï¼ˆ3ä¸ªviewæ˜¯åŒçº§å…³ç³»ï¼‰ï¼Œé‚£ä¹ˆç³»ç»Ÿç”¨<code class="highlighter-rouge">hitTest</code>ä»¥åŠ<code class="highlighter-rouge">pointInside</code>æ—¶ä¼šå…ˆä»view3å¼€å§‹ä¾¿åˆ©ï¼Œå¦‚æœ<code class="highlighter-rouge">pointInside</code>è¿”å›YESå°±ç»§ç»­éå†view3çš„subviewsï¼ˆå¦‚æœview3æ²¡æœ‰å­è§†å›¾ï¼Œé‚£ä¹ˆä¼šè¿”å›view3ï¼‰ï¼Œå¦‚æœ<code class="highlighter-rouge">pointInside</code>è¿”å›NOå°±å¼€å§‹éå†view2ã€‚ååºéå†ï¼Œæœ€åä¸€ä¸ªæ·»åŠ çš„subviewå¼€å§‹ã€‚ä¹Ÿç®—æ˜¯ä¸€ç§ç®—æ³•ä¼˜åŒ–ã€‚åé¢ä¼šå…·ä½“ä»‹ç»<code class="highlighter-rouge">hitTest</code>çš„å†…éƒ¨å®ç°å’Œå…·ä½“ä½¿ç”¨åœºæ™¯ã€‚</p>
  </li>
  <li>
    <p>UITouchä¼šç»™gestureRecognizerså’Œæœ€ä¼˜å“åº”è€…ä¹Ÿå°±æ˜¯hitTestViewå‘é€æ¶ˆæ¯</p>

    <ul>
      <li>é»˜è®¤viewä¼šèµ°å…¶<code class="highlighter-rouge">touchBegan:withEvent:</code>ç­‰æ–¹æ³•ï¼Œå½“gestureRecognizersæ‰¾åˆ°è¯†åˆ«çš„gestureRecognizeråï¼Œå°†ä¼šç‹¬è‡ªå æœ‰è¯¥touchï¼Œå³ä¼šè°ƒç”¨å…¶ä»–gestureRecognizerå’ŒhitTest viewçš„<code class="highlighter-rouge">touchCancelled:withEvent:</code>æ–¹æ³•ï¼Œå¹¶ä¸”å®ƒä»¬ä¸å†æ”¶åˆ°è¯¥toucheäº‹ä»¶ï¼Œä¹Ÿå°±ä¸ä¼šèµ°å“åº”é“¾æµç¨‹ã€‚ä¸‹é¢ä¼šå…·ä½“é˜è¿°UIContolå’ŒUIScrollViewå’Œå…¶å­ç±»ä¸æ‰‹åŠ¿ä¹‹é—´çš„å†²çªå’Œå…³ç³»ã€‚</li>
    </ul>
  </li>
  <li>
    <p>å½“è¯¥äº‹ä»¶å“åº”å®Œæ¯•ï¼Œä¸»çº¿ç¨‹çš„Runloopå¼€å§‹ç¡çœ ï¼Œç­‰å¾…ä¸‹ä¸€ä¸ªäº‹ä»¶ã€‚</p>
  </li>
</ul>

<h3 id="äºŒ-äº‹ä»¶ä¼ é€’">äºŒ. äº‹ä»¶ä¼ é€’</h3>

<h4 id="21-hittestwitheventå’Œpointinsidewithevent">2.1 hitTest:withEvent:å’ŒpointInside:withEvent:</h4>

<p>ç¤ºä¾‹å›¾ï¼š</p>

<p><img src="https://raw.githubusercontent.com/limeng99/limeng99.github.io/master/assets/img/screenshots/event-test.png" alt="event-test" /></p>

<p>ç¤ºä¾‹ä»£ç ï¼š</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>LMGrayView *grayView = [[LMGrayView alloc] initWithFrame:CGRectMake(100, 200, kScreenWidth/2, 400)];
grayView.backgroundColor = [UIColor grayColor];
[self.view addSubview:grayView];

LMRedView *redView = [[LMRedView alloc] initWithFrame:CGRectMake(0, 0, grayView.bounds.size.width / 2, grayView.bounds.size.height / 3)];
redView.backgroundColor = [UIColor redColor];
[grayView addSubview:redView];

LMBlueView *blueView = [[LMBlueView alloc] initWithFrame:CGRectMake(grayView.bounds.size.width/2, grayView.bounds.size.height * 2/3, grayView.bounds.size.width/2, grayView.bounds.size.height/3)];
blueView.backgroundColor = [UIColor blueColor];
// blueView.userInteractionEnabled = NO;
// blueView.hidden = YES;
// blueView.alpha = 0.1;
[grayView addSubview:blueView];

LMYellowView *yellowView = [[LMYellowView alloc] initWithFrame:CGRectMake(CGRectGetMinX(grayView.frame), CGRectGetMaxY(grayView.frame) + 20, grayView.bounds.size.width, 100)];
yellowView.backgroundColor = [UIColor yellowColor];
[self.view addSubview:yellowView];
</code></pre></div></div>
<p>LMGrayViewä¸­çš„ä»£ç ï¼š</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>- (UIView *)hitTest:(CGPoint)point withEvent:(UIEvent *)event {
    NSLog(@"method: %s", __PRETTY_FUNCTION__);
    return [super hitTest:point withEvent:event];
}

- (BOOL)pointInside:(CGPoint)point withEvent:(UIEvent *)event {
    NSLog(@"method: %s", __PRETTY_FUNCTION__);
    return [super pointInside:point withEvent:event];
}
</code></pre></div></div>

<p>ç‚¹å‡»redViewï¼Œæ‰“å°æ—¥å¿—ï¼š</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>2019-12-30 14:13:37.206432+0800 Event-Demo[39601:999578] method: -[LMYellowView hitTest:withEvent:]
2019-12-30 14:13:37.206691+0800 Event-Demo[39601:999578] method: -[LMYellowView pointInside:withEvent:]
2019-12-30 14:13:37.206888+0800 Event-Demo[39601:999578] method: -[LMGrayView hitTest:withEvent:]
2019-12-30 14:13:37.207052+0800 Event-Demo[39601:999578] method: -[LMGrayView pointInside:withEvent:]
2019-12-30 14:13:37.207243+0800 Event-Demo[39601:999578] method: -[LMBlueView hitTest:withEvent:]
2019-12-30 14:13:37.207425+0800 Event-Demo[39601:999578] method: -[LMBlueView pointInside:withEvent:]
2019-12-30 14:13:37.207581+0800 Event-Demo[39601:999578] method: -[LMRedView hitTest:withEvent:]
2019-12-30 14:13:37.207730+0800 Event-Demo[39601:999578] method: -[LMRedView pointInside:withEvent:]
2019-12-30 14:13:37.208041+0800 Event-Demo[39601:999578] method: -[LMYellowView hitTest:withEvent:]
2019-12-30 14:13:37.208186+0800 Event-Demo[39601:999578] method: -[LMYellowView pointInside:withEvent:]
2019-12-30 14:13:37.208336+0800 Event-Demo[39601:999578] method: -[LMGrayView hitTest:withEvent:]
2019-12-30 14:13:37.208502+0800 Event-Demo[39601:999578] method: -[LMGrayView pointInside:withEvent:]
2019-12-30 14:13:37.208863+0800 Event-Demo[39601:999578] method: -[LMBlueView hitTest:withEvent:]
2019-12-30 14:13:37.209127+0800 Event-Demo[39601:999578] method: -[LMBlueView pointInside:withEvent:]
2019-12-30 14:13:37.209373+0800 Event-Demo[39601:999578] method: -[LMRedView hitTest:withEvent:]
2019-12-30 14:13:37.225252+0800 Event-Demo[39601:999578] method: -[LMRedView pointInside:withEvent:]
</code></pre></div></div>

<p>ç»æµ‹è¯•å¯å¾—çŸ¥ï¼š</p>

<ul>
  <li>-hitTest:withEvent: æ–¹æ³•å†…éƒ¨ä¼šè°ƒç”¨ -pointInside:withEvent: æ–¹æ³•ã€‚</li>
  <li>ä¸€æ¬¡ç‚¹å‡»ä¼šè§¦å‘ä¸¤æ¬¡ -hitTest:withEvent: æ–¹æ³•ã€‚</li>
  <li>-pointInside:withEvent: æ–¹æ³•ä¼šåˆ¤æ–­è§¦æ‘¸ç‚¹æ˜¯å¦åœ¨å½“å‰è§†å›¾èŒƒå›´å†…ã€‚</li>
  <li>-hitTest:withEvent: æ–¹æ³•æ ¹æ® -pointInside:withEvent: çš„è¿”å›å€¼å†³å®šæ˜¯å¦è¿”å›å½“å‰è§†å›¾ã€‚</li>
  <li>è°ƒç”¨é¡ºåºæ˜¯ï¼Œå¦‚æœè·¨çº§ï¼Œå°±ä»çˆ¶è§†å›¾é€çº§å‘å…¶å­è§†å›¾éå†è°ƒç”¨ï¼›å¦‚æœåŒçº§ï¼Œå°±æŒ‰ç…§åŒçº§å­è§†å›¾æ·»åŠ åˆ°å…¶çˆ¶è§†å›¾ä¸Šçš„é¡ºåºï¼Œä»åå‘å‰éå†ï¼Œå³åæ·»åŠ çš„å…ˆéå†ï¼Œå…ˆæ·»åŠ çš„åéå†çš„ FILO æ¨¡å¼ã€‚</li>
  <li>å¦‚æœçˆ¶è§†å›¾çš„ -pointInside:withEvent: æ–¹æ³•è¿”å› NOï¼Œå°±ä¸ä¼šéå†å…¶å­è§†å›¾ï¼›å¦‚æœè¿”å› YESï¼Œå°±ä¼šéå†å…¶å­è§†å›¾ï¼Œå³è°ƒç”¨å…¶å­è§†å›¾çš„ -hitTest:withEvent: æ–¹æ³•ã€‚</li>
  <li>å¦‚æœä¸€ä¸ªå­è§†å›¾çš„ -hitTest:withEvent: æ–¹æ³•è¿”å›å€¼ä¸ä¸º nilï¼Œé‚£ä¹ˆå°±åœæ­¢éå†ï¼Œä¸ä¼šç»§ç»­è°ƒç”¨å°šæœªéå†è¿‡çš„åŒçº§å­è§†å›¾çš„ -hitTest:withEvent: æ–¹æ³•ã€‚</li>
  <li>-hitTest:withEvent: æ–¹æ³•è¿”å›çš„è§†å›¾å†³å®šæœ€åå“åº”äº‹ä»¶çš„å¯¹è±¡ã€‚</li>
</ul>

<p>æ€»ç»“ï¼šåœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œå³ä¸é‡å†™ä¸Šè¿°ä¸¤ä¸ªæ–¹æ³•çš„æƒ…å†µä¸‹ï¼Œå½“ç‚¹å‡»å±å¹•æ—¶ï¼Œä¼šä»æœ€åº•å±‚çš„çˆ¶è§†å›¾å¼€å§‹å‘ä¸Šé€çº§éå†ï¼Œç›´åˆ°æœ€é¡¶å±‚çš„å­è§†å›¾ã€‚å¦‚æœå‘ç°è§¦æ‘¸ç‚¹åœ¨å½“å‰è§†å›¾èŒƒå›´å†…ï¼Œå°±ä¼šéå†å½“å‰è§†å›¾çš„å­è§†å›¾ï¼Œæ£€æµ‹è§¦ç‚¹æ˜¯å¦åœ¨å…¶å­è§†å›¾èŒƒå›´å†…ï¼Œå¦‚æœåœ¨å­è§†å›¾èŒƒå›´å†…å°±æ£€æµ‹è¯¥å­è§†å›¾çš„å­è§†å›¾ï¼Œé‡å¤è¿™ä¸ªè¿‡ç¨‹ç›´åˆ°æ‰¾åˆ°ä¸€ä¸ªè§†å›¾å®ƒæ²¡æœ‰å­è§†å›¾æ»¡è¶³è§¦æ‘¸ç‚¹åœ¨å…¶èŒƒå›´å†…ï¼Œæ¢å¥è¯è¯´å°±æ˜¯æ‰¾åˆ°ä¸€ä¸ªè§¦ç‚¹åœ¨å…¶èŒƒå›´å†…çš„æœ€é¡¶å±‚çš„è§†å›¾ã€‚</p>

<h4 id="22-hittestwitheventå†…éƒ¨å®ç°ä»£ç è¿˜åŸ">2.2 hitTest:withEvent:å†…éƒ¨å®ç°ä»£ç è¿˜åŸ</h4>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>- (UIView *)hitTest:(CGPoint)point withEvent:(UIEvent *)event {
    NSLog(@"-----%@",self.nextResponder.class);
    if (!self.isUserInteractionEnabled || self.isHidden || self.alpha &lt;= 0.01) return nil;
    //åˆ¤æ–­ç‚¹åœ¨ä¸åœ¨è¿™ä¸ªè§†å›¾é‡Œ
    if ([self pointInside:point withEvent:event]) {
        //åœ¨è¿™ä¸ªè§†å›¾ éå†è¯¥è§†å›¾çš„å­è§†å›¾
        for (UIView *subview in [self.subviews reverseObjectEnumerator]) {
            //è½¬æ¢åæ ‡åˆ°å­è§†å›¾
            CGPoint convertedPoint = [subview convertPoint:point fromView:self];
            //é€’å½’è°ƒç”¨hitTest:withEventç»§ç»­åˆ¤æ–­
            UIView *hitTestView = [subview hitTest:convertedPoint withEvent:event];
            if (hitTestView) {
                //åœ¨è¿™é‡Œæ‰“å°self.classå¯ä»¥çœ‹åˆ°é€’å½’è¿”å›çš„é¡ºåºã€‚
                return hitTestView;
            }
        }
        //è¿™é‡Œå°±æ˜¯è¯¥è§†å›¾æ²¡æœ‰å­è§†å›¾äº† ç‚¹åœ¨è¯¥è§†å›¾ä¸­ï¼Œæ‰€ä»¥ç›´æ¥è¿”å›æœ¬èº«ï¼Œä¸Šé¢çš„hitTestViewå°±æ˜¯è¿™ä¸ªã€‚
        NSLog(@"é€‰ä¸­çš„view:%@",self.class);
        return self;
    }
    //ä¸åœ¨è¿™ä¸ªè§†å›¾ç›´æ¥è¿”å›nil
    return nil;
}
</code></pre></div></div>

<h4 id="23-hittestwitheventåº”ç”¨å®ä¾‹">2.3 hitTest:withEvent:åº”ç”¨å®ä¾‹</h4>

<p>1ã€æ‰©å¤§Buttonçš„ç‚¹å‡»åŒºåŸŸ</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>- (BOOL)pointInside:(CGPoint)point withEvent:(UIEvent *)event {
    if (CGRectContainsPoint(CGRectInset(self.bounds, -20, -20), point)) {
        return YES;
    }
    return NO;
}
</code></pre></div></div>

<p>2ã€å­viewè¶…å‡ºäº†çˆ¶viewçš„boundså“åº”äº‹ä»¶</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ç¬¬ä¸€ç§æ–¹æ³•ï¼š
- (BOOL)pointInside:(CGPoint)point withEvent:(UIEvent *)event {
    BOOL flag = NO;
    for (UIView *view in self.subviews) {
        if (CGRectContainsPoint(view.frame, point)){
            flag = YES;
            break;
        }
    }
    return flag;
}

ç¬¬äºŒç§æ–¹æ³•ï¼š
- (UIView *)hitTest:(CGPoint)point withEvent:(UIEvent *)event {
    if (!self.isUserInteractionEnabled || self.isHidden || self.alpha &lt;= 0.01) {
        return nil;
    }
    if ([self pointInside:point withEvent:event]) {
        for (UIView *subview in [self.subviews reverseObjectEnumerator]) {
            CGPoint convertedPoint = [subview convertPoint:point fromView:self];
            UIView *hitTestView = [subview hitTest:convertedPoint withEvent:event];
            if (hitTestView) {
                return hitTestView;
            }
        }
        return self;
    }
    return nil;
}
</code></pre></div></div>

<p>3ã€å¦‚æœButtonè¢«ä¸€ä¸ªViewé®ä½ï¼Œåœ¨è§¦æ‘¸Viewæ—¶ï¼Œå¸Œæœ›è¯¥Buttonèƒ½å¤Ÿå“åº”äº‹ä»¶</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>in View.mé‡Œï¼Œç¬¬ä¸€ç§æ–¹æ³•ï¼š
å‡»ViewåŠViewçš„éäº¤äº’å­View(ä¾‹å¦‚UIImageView)ï¼Œåˆ™è¯¥Buttonå¯ä»¥å“åº”äº‹ä»¶
- (BOOL)pointInside:(CGPoint)point withEvent:(UIEvent *)event {
    BOOL next = YES;
    for (UIView *view in self.subviews) {
        if ([view isKindOfClass:[UIControl class]]) {
            if (CGRectContainsPoint(view.frame, point)){
                next = NO;
                break;
            }
        }
    }
    return !next;
}

in View.mé‡Œï¼Œç¬¬äºŒç§æ–¹æ³•ï¼š
ç‚¹å‡»Viewæœ¬èº«Buttonä¼šå“åº”è¯¥äº‹ä»¶ï¼Œç‚¹å‡»Viewçš„ä»»ä½•ä¸€ä¸ªå­Viewï¼ŒButtonä¸ä¼šå“åº”äº‹ä»¶
- (UIView *)hitTest:(CGPoint)point withEvent:(UIEvent *)event {
    UIView *view = [super hitTest:point withEvent:event];
    if (view == self) {
        return nil;
    }
    return view;
}
</code></pre></div></div>

<p>4ã€ScrollView pageæ»‘åŠ¨</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>in scrollView.mï¼Œç¬¬ä¸€ç§æ–¹æ³•ï¼š
- (BOOL)pointInside:(CGPoint)point withEvent:(UIEvent *)event{
    if (CGRectContainsPoint(CGRectInset(self.bounds, -40, 0), point)) {
        return YES;
    }
    return NO;
}

in scrollView.superView.mï¼Œç¬¬äºŒç§æ–¹æ³•ï¼š
- (UIView *)hitTest:(CGPoint)point withEvent:(UIEvent *)event {
    UIView *hitTestView = [super hitTest:point withEvent:event];
    if (hitTestView) {
        hitTestView = self.scrollView;
    }
    return hitTestView;
}
</code></pre></div></div>

<h3 id="ä¸‰-äº‹ä»¶å“åº”">ä¸‰. äº‹ä»¶å“åº”</h3>

<h4 id="31-å“åº”é“¾çš„ç»„æˆ">3.1 å“åº”é“¾çš„ç»„æˆ</h4>

<p><img src="https://raw.githubusercontent.com/limeng99/limeng99.github.io/master/assets/img/screenshots/event-response.png" alt="event-response" /></p>

<p>ä¹‹å‰ç¤ºä¾‹ä»£ç ï¼ŒLMGrayViewä¸­çš„ä»£ç ï¼š</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>- (void)touchesBegan:(NSSet&lt;UITouch *&gt; *)touches withEvent:(UIEvent *)event {
    NSLog(@"method: %s", __PRETTY_FUNCTION__);
    [super touchesBegan:touches withEvent:event];
}

- (void)touchesEnded:(NSSet&lt;UITouch *&gt; *)touches withEvent:(UIEvent *)event {
    NSLog(@"method: %s", __PRETTY_FUNCTION__);
    [super touchesEnded:touches withEvent:event];
}
</code></pre></div></div>

<p>ç‚¹å‡»redViewï¼Œæ‰“å°æ—¥å¿—ï¼š</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>2019-12-30 15:17:02.486239+0800 Event-Demo[39956:1042564] method: -[LMRedView touchesBegan:withEvent:]
2019-12-30 15:17:02.486401+0800 Event-Demo[39956:1042564] method: -[LMGrayView touchesBegan:withEvent:]
2019-12-30 15:17:02.486529+0800 Event-Demo[39956:1042564] method: -[ViewController touchesBegan:withEvent:]
2019-12-30 15:17:02.486969+0800 Event-Demo[39956:1042564] method: -[LMRedView touchesEnded:withEvent:]
2019-12-30 15:17:02.487088+0800 Event-Demo[39956:1042564] method: -[LMGrayView touchesEnded:withEvent:]
2019-12-30 15:17:02.487198+0800 Event-Demo[39956:1042564] method: -[ViewController touchesEnded:withEvent:]
</code></pre></div></div>

<p>å› ä¸ºåªå®ç°åˆ°controllerçš„touchesäº‹ä»¶æ–¹æ³•å› æ­¤åªæ‰“å°åˆ°Controllerã€‚</p>

<p>ç»æµ‹è¯•å¯å¾—çŸ¥ï¼š</p>

<ul>
  <li>
    <p>å“åº”é“¾æ˜¯é€šè¿‡nextResponderå±æ€§ç»„æˆçš„ä¸€ä¸ªé“¾è¡¨ã€‚</p>
  </li>
  <li>
    <p>åœ¨äº‹ä»¶çš„å“åº”ä¸­ï¼Œå¦‚æœæŸä¸ªæ§ä»¶å®ç°äº†touchesâ€¦æ–¹æ³•ï¼Œåˆ™è¿™ä¸ªäº‹ä»¶å°†ç”±è¯¥æ§ä»¶æ¥æ¥å—ï¼Œå¦‚æœè°ƒç”¨äº†[supertouchesâ€¦.];å°±ä¼šå°†äº‹ä»¶é¡ºç€å“åº”è€…é“¾æ¡å¾€ä¸Šä¼ é€’ï¼Œä¼ é€’ç»™ä¸Šä¸€ä¸ªå“åº”è€…ï¼›æ¥ç€å°±ä¼šè°ƒç”¨ä¸Šä¸€ä¸ªå“åº”è€…çš„touchesâ€¦.æ–¹æ³•ã€‚</p>
  </li>
  <li>
    <p>å¦‚æœå½“å‰viewæ˜¯æ§åˆ¶å™¨çš„viewï¼Œé‚£ä¹ˆæ§åˆ¶å™¨å°±æ˜¯ä¸Šä¸€ä¸ªå“åº”è€…ï¼Œäº‹ä»¶å°±ä¼ é€’ç»™æ§åˆ¶å™¨ï¼›å¦‚æœå½“å‰viewä¸æ˜¯æ§åˆ¶å™¨çš„viewï¼Œé‚£ä¹ˆçˆ¶è§†å›¾å°±æ˜¯å½“å‰viewçš„ä¸Šä¸€ä¸ªå“åº”è€…ï¼Œäº‹ä»¶å°±ä¼ é€’ç»™å®ƒçš„çˆ¶è§†å›¾ã€‚</p>
  </li>
  <li>
    <p>åœ¨è§†å›¾å±‚æ¬¡ç»“æ„çš„æœ€é¡¶çº§è§†å›¾ï¼Œå¦‚æœä¹Ÿä¸èƒ½å¤„ç†æ”¶åˆ°çš„äº‹ä»¶æˆ–æ¶ˆæ¯ï¼Œåˆ™å…¶å°†äº‹ä»¶æˆ–æ¶ˆæ¯ä¼ é€’ç»™windowå¯¹è±¡è¿›è¡Œå¤„ç†ã€‚</p>
  </li>
  <li>
    <p>å¦‚æœwindowå¯¹è±¡ä¹Ÿä¸å¤„ç†ï¼Œåˆ™å…¶å°†äº‹ä»¶æˆ–æ¶ˆæ¯ä¼ é€’ç»™UIApplicationå¯¹è±¡ã€‚</p>
  </li>
  <li>
    <p>å¦‚æœUIApplicationä¹Ÿä¸èƒ½å¤„ç†è¯¥äº‹ä»¶æˆ–æ¶ˆæ¯ï¼Œåˆ™å°†å…¶ä¸¢å¼ƒã€‚</p>
  </li>
</ul>

<h4 id="32-uicontrolä¸uiscrollviewé˜»æ–­å“åº”é“¾">3.2 UIControlä¸UIScrollViewé˜»æ–­å“åº”é“¾</h4>

<p>å°†å®ä¾‹ä¸­çš„grayViewæ›¿æ¢æˆbuttonæˆ–scrollView</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>LMButton *button = [[LMButton alloc] initWithFrame:CGRectMake(100, 200, kScreenWidth/2, 400)];
button.backgroundColor = [UIColor grayColor];
[self.view addSubview:button];

// LMScrollView *scrollView = [[LMScrollView alloc] initWithFrame:CGRectMake(100, 200, kScreenWidth/2, 400)];
// scrollView.backgroundColor = [UIColor grayColor];
// [self.view addSubview:scrollView];

LMRedView *redView = [[LMRedView alloc] initWithFrame:CGRectMake(0, 0, button.bounds.size.width / 2, button.bounds.size.height / 3)];
redView.backgroundColor = [UIColor redColor];
[button addSubview:redView];
</code></pre></div></div>

<p>ç‚¹å‡»redViewï¼Œæ‰“å°æ—¥å¿—ï¼š</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>2019-12-30 15:43:52.429658+0800 Event-Demo[40130:1060351] method: -[LMRedView touchesBegan:withEvent:]
2019-12-30 15:43:52.429797+0800 Event-Demo[40130:1060351] method: -[LMButton touchesBegan:withEvent:]
2019-12-30 15:43:52.434574+0800 Event-Demo[40130:1060351] method: -[LMRedView touchesEnded:withEvent:]
2019-12-30 15:43:52.434771+0800 Event-Demo[40130:1060351] method: -[LMButton touchesEnded:withEvent:]

æˆ–

2019-12-30 15:47:26.362262+0800 Event-Demo[40167:1063630] method: -[LMRedView touchesBegan:withEvent:]
2019-12-30 15:47:26.362456+0800 Event-Demo[40167:1063630] method: -[LMScrollView touchesBegan:withEvent:]
2019-12-30 15:47:26.362628+0800 Event-Demo[40167:1063630] method: -[LMRedView touchesEnded:withEvent:]
2019-12-30 15:47:26.362793+0800 Event-Demo[40167:1063630] method: -[LMScrollView touchesEnded:withEvent:]
</code></pre></div></div>

<p>ç»æµ‹è¯•å¯å¾—çŸ¥ï¼š</p>

<ul>
  <li>
    <p>UIControlä¸UIScrollViewä¼šé˜»æ–­å“åº”é“¾ï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨å“åº”UIControlä¸UIScrollViewè‡ªèº«å¯¹touchçš„å¤„ç†æ–¹å¼å¹¶ä¸ä¼šè°ƒç”¨nextResponderå¯¹åº”çš„æ–¹æ³•ã€‚</p>
  </li>
  <li>
    <p>é€šè¿‡åœ¨Buttonå­ç±»ä¸­é‡å†™touchesçš„æ–¹æ³•ï¼Œå‘ç°å¦‚æœä¸è°ƒç”¨superçš„toucheså¯¹åº”çš„æ–¹æ³•åˆ™ä¸ä¼šå“åº”ç‚¹å‡»äº‹ä»¶ã€‚ç”±æ­¤å¯ä»¥å¤§è‡´æ¨æ–­å‡ºUIControlå…¶å­ç±»å“åº”ç‚¹å‡»åŸç†å¤§è‡´ä¸ºï¼šæ ¹æ®æ·»åŠ target:action:æ—¶è®¾ç½®çš„UIControlEventsï¼Œåœ¨touchesçš„åˆé€‚æ–¹æ³•è°ƒç”¨targetçš„actionæ–¹æ³•ã€‚</p>
  </li>
  <li>
    <p>é€šè¿‡é‡å†™tableViewå­ç±»çš„touchesæ–¹æ³•ï¼Œå‘ç°å¦‚æœä¸è°ƒç”¨superçš„toucheså¯¹åº”çš„æ–¹æ³•åˆ™ä¸ä¼šèµ°tableview:didSelectRowAtIndexPath:æ–¹æ³•ã€‚ç”±æ­¤å¯ä»¥å¤§è‡´æ¨æ–­å‡ºUIScrollViewå…¶å­ç±»æ˜¯åœ¨å…¶touchesæ–¹æ³•ä¸­å¤„ç†ç‚¹å‡»äº‹ä»¶çš„ã€‚</p>
  </li>
</ul>

<h3 id="å››-æ‰‹åŠ¿gesture">å››. æ‰‹åŠ¿Gesture</h3>

<h4 id="41-æ‰‹åŠ¿gestureä¸touchäº‹ä»¶çš„å…³ç³»">4.1 æ‰‹åŠ¿Gestureä¸Touchäº‹ä»¶çš„å…³ç³»</h4>

<p>å°†ç¤ºä¾‹ä¸­çš„grayView/redView/blueViewæ·»åŠ æ‰‹åŠ¿ï¼š</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>LMGrayGestureRecognizer *grayGesture = [[LMGrayGestureRecognizer alloc] initWithTarget:self action:@selector(grayViewClick:)];
[grayView addGestureRecognizer:grayGesture];

LMRedGestureRecognizer *redGesture = [[LMRedGestureRecognizer alloc] initWithTarget:self action:@selector(redViewClick:)];
[redView addGestureRecognizer:redGesture];

LMBlueGestureRecognizer *blueGesture = [[LMBlueGestureRecognizer alloc] initWithTarget:self action:@selector(blueViewClick:)];
[blueView addGestureRecognizer:blueGesture];
</code></pre></div></div>

<p>ç‚¹å‡»redViewï¼Œæ‰“å°æ—¥å¿—ï¼š</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ç¬¬ä¸€æ¬¡ç‚¹å‡»ï¼š
2019-12-30 16:18:28.629710+0800 Event-Demo[40396:1087484] method: -[LMGrayGestureRecognizer touchesBegan:withEvent:]
2019-12-30 16:18:28.629952+0800 Event-Demo[40396:1087484] method: -[LMRedGestureRecognizer touchesBegan:withEvent:]
2019-12-30 16:18:28.630483+0800 Event-Demo[40396:1087484] method: -[LMRedView touchesBegan:withEvent:]
2019-12-30 16:18:28.630679+0800 Event-Demo[40396:1087484] method: -[LMGrayView touchesBegan:withEvent:]
2019-12-30 16:18:28.630829+0800 Event-Demo[40396:1087484] method: -[ViewController touchesBegan:withEvent:]
2019-12-30 16:18:28.666787+0800 Event-Demo[40396:1087484] method: -[LMGrayGestureRecognizer touchesEnded:withEvent:]
2019-12-30 16:18:28.667075+0800 Event-Demo[40396:1087484] method: -[LMRedGestureRecognizer touchesEnded:withEvent:]
2019-12-30 16:18:28.667517+0800 Event-Demo[40396:1087484] method: -[ViewController redViewClick:]
2019-12-30 16:18:28.667757+0800 Event-Demo[40396:1087484] method: -[LMRedView touchesCancelled:withEvent:]
2019-12-30 16:18:28.667937+0800 Event-Demo[40396:1087484] method: -[LMGrayView touchesCancelled:withEvent:]
2019-12-30 16:18:28.668081+0800 Event-Demo[40396:1087484] method: -[ViewController touchesCancelled:withEvent:]


ç¬¬äºŒæ¬¡åŠåç»­ç‚¹å‡»ï¼š
2019-12-30 16:18:55.156758+0800 Event-Demo[40396:1087484] method: -[LMGrayGestureRecognizer touchesBegan:withEvent:]
2019-12-30 16:18:55.156899+0800 Event-Demo[40396:1087484] method: -[LMRedGestureRecognizer touchesBegan:withEvent:]
2019-12-30 16:18:55.157147+0800 Event-Demo[40396:1087484] method: -[LMRedView touchesBegan:withEvent:]
2019-12-30 16:18:55.157276+0800 Event-Demo[40396:1087484] method: -[LMGrayView touchesBegan:withEvent:]
2019-12-30 16:18:55.157385+0800 Event-Demo[40396:1087484] method: -[ViewController touchesBegan:withEvent:]
2019-12-30 16:18:55.157665+0800 Event-Demo[40396:1087484] method: -[LMGrayGestureRecognizer touchesEnded:withEvent:]
2019-12-30 16:18:55.157803+0800 Event-Demo[40396:1087484] method: -[LMRedGestureRecognizer touchesEnded:withEvent:]
2019-12-30 16:18:55.158070+0800 Event-Demo[40396:1087484] method: -[ViewController redViewClick:]
2019-12-30 16:18:55.158197+0800 Event-Demo[40396:1087484] method: -[LMRedView touchesCancelled:withEvent:]
2019-12-30 16:18:55.158283+0800 Event-Demo[40396:1087484] method: -[LMGrayView touchesCancelled:withEvent:]
2019-12-30 16:18:55.158548+0800 Event-Demo[40396:1087484] method: -[ViewController touchesCancelled:withEvent:]
</code></pre></div></div>

<p>ç»æµ‹è¯•å¯å¾—çŸ¥ï¼š</p>

<ul>
  <li>
    <p>å½“é€šè¿‡<code class="highlighter-rouge">hitTest</code>å’Œ<code class="highlighter-rouge">pointInside</code>æ‰¾åˆ°æœ€ä¼˜å“åº”è€…åï¼Œä¼šç»™gestureRecognizerså’Œç›¸åº”çš„viewåŒæ—¶å‘é€touchBeginæ¶ˆæ¯ï¼Œå¦‚æœæ‰¾åˆ°åˆé€‚gestureRecognizeråˆ™ä¼šç‹¬æœ‰è¯¥touchesï¼Œå³è°ƒç”¨viewçš„touheCancelæ¶ˆæ¯ï¼Œæ¥ç€æœ‰gestreRecognizeræ¥å“åº”äº‹ä»¶ã€‚</p>
  </li>
  <li>
    <p><code class="highlighter-rouge">cancelsTouchesInView</code>ï¼šé»˜è®¤ä¸ºYESã€‚è¡¨ç¤ºå½“æ‰‹åŠ¿è¯†åˆ«æˆåŠŸåï¼Œå–æ¶ˆæœ€ä½³å“åº”è€…å¯¹è±¡å¯¹äºäº‹ä»¶çš„å“åº”ï¼Œå¹¶ä¸å†å‘æœ€ä½³å“åº”è€…å‘é€äº‹ä»¶ã€‚è‹¥è®¾ç½®ä¸ºNOï¼Œåˆ™è¡¨ç¤ºåœ¨æ‰‹åŠ¿è¯†åˆ«å™¨è¯†åˆ«æˆåŠŸåä»ç„¶å‘æœ€ä½³å“åº”è€…å‘é€äº‹ä»¶ï¼Œæœ€ä½³å“åº”è€…ä»å“åº”äº‹ä»¶ã€‚</p>
  </li>
  <li>
    <p><code class="highlighter-rouge">delaysTouchesBegan</code>ï¼šé»˜è®¤ä¸ºNOï¼Œå³åœ¨æ‰‹åŠ¿è¯†åˆ«å™¨è¯†åˆ«æ‰‹åŠ¿æœŸé—´ï¼Œè§¦æ‘¸å¯¹è±¡çŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶ï¼Œéƒ½ä¼šå‘é€ç»™æœ€ä½³å“åº”è€…ï¼Œè‹¥è®¾ç½®æˆyesï¼Œåˆ™åœ¨è¯†åˆ«æ‰‹åŠ¿æœŸé—´ï¼Œè§¦æ‘¸çŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶ä¸ä¼šå‘é€ç»™æœ€ä½³å“åº”è€…ã€‚</p>
  </li>
  <li>
    <p><code class="highlighter-rouge">delaysTouchesEnded</code>ï¼šé»˜è®¤ä¸ºNOã€‚é»˜è®¤æƒ…å†µä¸‹å½“æ‰‹åŠ¿è¯†åˆ«å™¨æœªèƒ½è¯†åˆ«æ‰‹åŠ¿æ—¶ï¼Œè‹¥æ­¤æ—¶è§¦æ‘¸å·²ç»ç»“æŸï¼Œåˆ™ä¼šç«‹å³é€šçŸ¥Applicationå‘é€çŠ¶æ€ä¸ºendçš„touchäº‹ä»¶ç»™æœ€ä½³å“åº”è€…ä»¥è°ƒç”¨<code class="highlighter-rouge"> touchesEnded:withEvent: </code>ç»“æŸäº‹ä»¶å“åº”ï¼›è‹¥è®¾ç½®ä¸ºYESï¼Œåˆ™ä¼šåœ¨æ‰‹åŠ¿è¯†åˆ«å¤±è´¥æ—¶ï¼Œå»¶è¿Ÿä¸€å°æ®µæ—¶é—´ï¼ˆ0.15sï¼‰å†è°ƒç”¨å“åº”è€…çš„ <code class="highlighter-rouge">touchesEnded:withEvent:</code>ã€‚</p>
  </li>
  <li></li>
</ul>

<h4 id="42-æ‰‹åŠ¿gestureå’Œuicontrolçš„å…³ç³»">4.2 æ‰‹åŠ¿Gestureå’ŒUIControlçš„å…³ç³»</h4>

<p>å°†ç¤ºä¾‹ä¸­çš„grayViewæ·»åŠ æ‰‹åŠ¿ï¼ŒredViewæ›¿æ¢æˆbuttonï¼š</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>LMGrayGestureRecognizer *grayGesture = [[LMGrayGestureRecognizer alloc] initWithTarget:self action:@selector(grayViewClick:)];
[grayView addGestureRecognizer:grayGesture];

LMButton *button = [[LMButton alloc] initWithFrame:CGRectMake(0, 0, grayView.bounds.size.width / 2, grayView.bounds.size.height / 3)];
button.backgroundColor = [UIColor redColor];
[button addTarget:self action:@selector(buttonClick:) forControlEvents:UIControlEventTouchUpInside];
[grayView addSubview:button];
</code></pre></div></div>

<p>ç‚¹å‡»buttonï¼Œæ‰“å°æ—¥å¿—ï¼š</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>2019-12-30 16:22:43.255640+0800 Event-Demo[40421:1091112] method: -[LMGrayGestureRecognizer touchesBegan:withEvent:]
2019-12-30 16:22:43.256213+0800 Event-Demo[40421:1091112] method: -[LMButton touchesBegan:withEvent:]
2019-12-30 16:22:43.261559+0800 Event-Demo[40421:1091112] method: -[LMGrayGestureRecognizer touchesEnded:withEvent:]
2019-12-30 16:22:43.261907+0800 Event-Demo[40421:1091112] method: -[LMButton touchesEnded:withEvent:]
2019-12-30 16:22:43.262199+0800 Event-Demo[40421:1091112] method: -[ViewController buttonClick:]
</code></pre></div></div>

<p>æœ‰æ‰‹åŠ¿çš„grayViewä¸Šå¢åŠ ä¸€ä¸ªbutton,buttonä¸Šå¢åŠ ä¸€ä¸ªviewï¼š</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>LMGrayGestureRecognizer *grayGesture = [[LMGrayGestureRecognizer alloc] initWithTarget:self action:@selector(grayViewClick:)];
[grayView addGestureRecognizer:grayGesture];

LMButton *button = [[LMButton alloc] initWithFrame:CGRectMake(0, 0, grayView.bounds.size.width / 2, grayView.bounds.size.height / 3)];
button.backgroundColor = [UIColor redColor];
[button addTarget:self action:@selector(buttonClick:) forControlEvents:UIControlEventTouchUpInside];
[grayView addSubview:button];

LMBlueView *blueView = [[LMBlueView alloc] initWithFrame:CGRectMake(0, 0, button.bounds.size.width/2, button.bounds.size.height/2)];
blueView.backgroundColor = [UIColor blueColor];
[button addSubview:blueView];
</code></pre></div></div>

<p>ç‚¹å‡»blueViewï¼Œæ‰“å°æ—¥å¿—ï¼š</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>2019-12-30 16:28:05.892085+0800 Event-Demo[40457:1095228] method: -[LMGrayGestureRecognizer touchesBegan:withEvent:]
2019-12-30 16:28:05.892806+0800 Event-Demo[40457:1095228] method: -[LMBlueView touchesBegan:withEvent:]
2019-12-30 16:28:05.899176+0800 Event-Demo[40457:1095228] method: -[LMButton touchesBegan:withEvent:]
2019-12-30 16:28:05.899547+0800 Event-Demo[40457:1095228] method: -[LMGrayGestureRecognizer touchesEnded:withEvent:]
2019-12-30 16:28:05.899825+0800 Event-Demo[40457:1095228] method: -[ViewController grayViewClick:]
2019-12-30 16:28:05.899964+0800 Event-Demo[40457:1095228] method: -[LMBlueView touchesCancelled:withEvent:]
2019-12-30 16:28:05.900087+0800 Event-Demo[40457:1095228] method: -[LMButton touchesCancelled:withEvent:]
</code></pre></div></div>

<p>ç»æµ‹è¯•æœ€ç»ˆå¾—çŸ¥ï¼š</p>

<ul>
  <li>UIControlåŠå…¶å­ç±»èƒ½å¤Ÿæ‰§è¡Œç‚¹å‡»äº‹ä»¶è€Œä¸æ˜¯èµ°åº•å±‚çš„æ‰‹åŠ¿çš„åŸå› ä¸ºï¼š<strong>åœ¨è¯†åˆ«åˆ°ç›¸åº”çš„gestureRecognizeråå¦‚æœå½“å‰çš„æœ€ä¼˜å“åº”è€…æ˜¯UIControlåŠå…¶å­ç±»å¹¶ä¸”å½“å‰çš„gestureRecognizerä¸æ˜¯UIContolä¸Šçš„æ‰‹åŠ¿ï¼Œåˆ™ä¼šå“åº”UIControlçš„<code class="highlighter-rouge">target:action:</code>çš„æ–¹æ³•ã€‚å¦åˆ™åˆ™ä¼šå“åº”gestureRecognizerçš„<code class="highlighter-rouge">target:action:</code>çš„æ–¹æ³•ã€‚</strong></li>
</ul>

<h4 id="43-æ‰‹åŠ¿gestureå’Œuiscrollviewçš„å…³ç³»">4.3 æ‰‹åŠ¿Gestureå’ŒUIScrollviewçš„å…³ç³»</h4>

<p>å°†ç¤ºä¾‹ä¸­çš„grayViewæ·»åŠ æ‰‹åŠ¿ï¼ŒredViewæ›¿æ¢æˆtableViewï¼š</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>LMGrayGestureRecognizer *grayGesture = [[LMGrayGestureRecognizer alloc] initWithTarget:self action:@selector(grayViewClick:)];
[grayView addGestureRecognizer:grayGesture];

LMTableView *tableView = [[LMTableView alloc] initWithFrame:CGRectMake(0, 0, grayView.bounds.size.width / 2, grayView.bounds.size.height / 3) style:UITableViewStylePlain];
tableView.backgroundColor = [UIColor redColor];
tableView.dataSource = self;
tableView.delegate = self;
[tableView registerClass:[UITableViewCell class] forCellReuseIdentifier:NSStringFromClass([UITableViewCell class])];
[grayView addSubview:tableView];
</code></pre></div></div>

<p>ç‚¹å‡»cellï¼Œæ‰“å°æ—¥å¿—ï¼š</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>æ— æ‰‹åŠ¿ï¼š
2019-12-30 16:40:55.246500+0800 Event-Demo[40548:1105091] method: -[LMTableView touchesBegan:withEvent:]
2019-12-30 16:40:55.247270+0800 Event-Demo[40548:1105091] method: -[LMTableView touchesEnded:withEvent:]
2019-12-30 16:40:55.248467+0800 Event-Demo[40548:1105091] method: -[ViewController tableView:didSelectRowAtIndexPath:]

æœ‰æ‰‹åŠ¿ï¼š
2019-12-30 16:38:34.628235+0800 Event-Demo[40526:1103012] method: -[LMGrayView pointInside:withEvent:]
2019-12-30 16:38:34.629412+0800 Event-Demo[40526:1103012] method: -[LMGrayGestureRecognizer touchesBegan:withEvent:]
2019-12-30 16:38:34.682632+0800 Event-Demo[40526:1103012] method: -[LMGrayGestureRecognizer touchesEnded:withEvent:]
2019-12-30 16:38:34.683721+0800 Event-Demo[40526:1103012] method: -[ViewController grayViewClick:]
</code></pre></div></div>

<p>ç»æµ‹è¯•æœ€ç»ˆå¾—çŸ¥ï¼š</p>

<ul>
  <li>UIScrollViewä¸ºæœ€ä¼˜å“åº”è€…å¹¶ä¸”çˆ¶æ§ä»¶æ²¡æœ‰æ‰‹åŠ¿æ—¶UIScrollViewæ‰å¯ä»¥è‡ªå·±å¤„ç†ç‚¹å‡»äº‹ä»¶ã€‚å¦åˆ™è¢«çˆ¶æ§ä»¶çš„gestureRecognizerå æœ‰ã€‚</li>
  <li>å½“çˆ¶æ§ä»¶æœ‰æ‰‹åŠ¿æ—¶UIScrollViewçš„touchesæ–¹æ³•éƒ½ä¸æ‰§è¡Œï¼Œç±»ä¼¼äºè®¾ç½®<code class="highlighter-rouge">delaysTouchesBegan</code>ä¸ºYESã€‚</li>
  <li>è™½ç„¶UIScrollViewåŠå…¶å­ç±»å’ŒUIControlåŠå…¶å­ç±»ç±»ä¼¼éƒ½å¯ä»¥é˜»æ–­å“åº”é“¾ï¼Œä½†æ˜¯å½“UIScrollViewåŠå…¶å­ç±»ä¸ºæœ€ä¼˜å“åº”è€…æ—¶ï¼Œå¦‚æœçˆ¶æ§ä»¶ä¸­æœ‰gestureRecognizerä¾ç„¶ä¼šè¢«å…¶å æœ‰ã€‚</li>
</ul>

<h4 id="44-uiscrollviewç‚¹å‡»ç©¿é€è§£å†³æ–¹æ¡ˆ">4.4 UIScrollViewç‚¹å‡»ç©¿é€è§£å†³æ–¹æ¡ˆ</h4>

<p>å½“UIScrollViewä¸ºæœ€ä¼˜å“åº”è€…çˆ¶æ§ä»¶æœ‰æ‰‹åŠ¿æ—¶ï¼ŒUIScrollViewåŠå…¶å­ç±»çš„ç‚¹å‡»ä»£ç†æ–¹æ³•å’Œ<code class="highlighter-rouge">touchesBegan</code>æ–¹æ³•ä¸å“åº”ã€‚</p>

<p>è§£å†³ä¸‰ç§åŠæ³•ï¼š</p>

<ul>
  <li>
    <p>å¯ä»¥é€šè¿‡ç»™çˆ¶æ§ä»¶æ‰‹åŠ¿è®¾ç½®cancelsTouchesInViewä¸ºNOï¼Œåˆ™ä¼šåŒæ—¶å“åº”gestureRecognizerçš„äº‹ä»¶å’ŒUIScrollViewåŠå…¶å­ç±»çš„ä»£ç†æ–¹æ³•å’Œtouchesäº‹ä»¶ã€‚</p>
  </li>
  <li>
    <p>åœ¨çˆ¶æ§ä»¶ä¸­çš„æ‰‹åŠ¿çš„ä»£ç†æ–¹æ³•é‡Œé¢åšä¸€ä¸‹åˆ¤æ–­ï¼Œå½“touchçš„viewæ˜¯æˆ‘ä»¬éœ€è¦è§¦å‘çš„viewçš„æ—¶å€™ï¼Œreturn NO ï¼Œè¿™æ ·å°±ä¸ä¼šèµ°æ‰‹åŠ¿æ–¹æ³•ï¼Œè€Œå»è§¦å‘è¿™ä¸ªtouch.viewè¿™ä¸ªå¯¹è±¡çš„æ–¹æ³•äº†ã€‚</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>- (BOOL)gestureRecognizer:(UIGestureRecognizer *)gestureRecognizer shouldReceiveTouch:(UITouch *)touch {
    if ([NSStringFromClass([touch.view class]) isEqualToString:@"UITableViewCellContentView"]){
        return NO;
    }
    return YES;
}
</code></pre></div>    </div>
  </li>
  <li>
    <p>å¯ä»¥é€šè¿‡ç»™UIScrollViewåŠå…¶å­ç±»æ·»åŠ gestureRecognizerï¼Œä»è€Œæ¥è°ƒç”¨éœ€è¦å¤„ç†çš„äº‹æƒ…ã€‚</p>
  </li>
</ul>

:ET